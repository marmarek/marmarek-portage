--- openssh-4.7p1.orig/scard-opensc.c	2008-01-21 00:43:33.000000000 +0100
+++ openssh-4.7p1/scard-opensc.c	2008-01-21 01:19:23.000000000 +0100
@@ -154,7 +154,19 @@
 		r = sc_lock(card);
 		if (r) {
 			error("Unable to lock smartcard: %s", sc_strerror(r));
-			goto err;
+			/* Workaround for pcscd restarted */
+			r = sc_init();
+			if (r) {
+				error("Unable to init smartcard: %s", sc_strerror(r));
+				goto err;
+			} else {
+				r = sc_lock(card);
+				if (r) {
+					error("Unable to lock smartcard: %s", sc_strerror(r));
+					goto err;
+				}
+			}
+
 		}
 		*key_obj_out = key_obj;
 		return 0;
@@ -183,7 +195,19 @@
 	r = sc_lock(card);
 	if (r) {
 		error("Unable to lock smartcard: %s", sc_strerror(r));
-		goto err;
+		/* Workaround for pcscd restarted */
+		r = sc_init();
+		if (r) {
+			error("Unable to init smartcard: %s", sc_strerror(r));
+			goto err;
+		} else {
+			r = sc_lock(card);
+			if (r) {
+				error("Unable to lock smartcard: %s", sc_strerror(r));
+				goto err;
+			}
+		}
+			
 	}
 	r = sc_pkcs15_verify_pin(p15card, pin, passphrase,
 				 strlen(passphrase));
